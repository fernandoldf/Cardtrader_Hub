{% extends "base.html" %}

{% block title %}Database Query - Cardtrader Hub{% endblock %}

{% block content %}
<div class="container search-console-container">
    <h2>DATABASE QUERY INTERFACE</h2>
    
    {# Bloco de Mensagens (Flash Messages) #}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="message-log-group">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        <span class="alert-icon">
                            {% if category == 'error' %} üõë 
                            {% elif category == 'warning' %} ‚ö†Ô∏è 
                            {% else %} ‚ÑπÔ∏è 
                            {% endif %}
                        </span>
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    {# Formul√°rio de Busca #}
    <form class="search-form" method="post" action="{{ url_for('card_search') }}">
        <input type="text" name="search_term" placeholder="[ENTER CARD NAME OR PARAMETER] e.g., Sol Ring" value="{{ search_term or '' }}"> 
        <button type="submit">INITIATE QUERY</button>
    </form>

    {% if search_term %}
        <div class="search-results">
            <h3>// QUERY RESULT: "{{ search_term }}"</h3>
            
            {% if cards and cards|length > 0 %}
                <div class="cards-grid">
                    {% for card in cards %}
                        <a href="{{ url_for('card_detail', card_id=card.id) }}" class="card-item">
                            <img src="{{ card.image_uris.normal }}" alt="{{ card.name }}" class="card-search-image">
                            <h4 class="card-name">{{ card.name }}</h4>
                        </a>
                    {% endfor %}
                </div>
                <p class="results-info">[SYSTEM LOG] Found {{ cards|length }} matching data object(s).</p>
            {% else %}
                <div class="warning-alert">
                    <p class="text-secondary">‚ö†Ô∏è No data objects found for query "{{ search_term }}".</p>
                </div>
            {% endif %}
        </div>
    {% else %}
        <p class="text-secondary">Input parameters above to retrieve data objects from the main database.</p>
    {% endif %}

    <a href="{{ url_for('home') }}" class="home-link">RETURN TO MAIN CONSOLE</a>
</div>
{% endblock %}